# Redis通信协议

## RESP协议

Redis是一个CS架构的软件，通信一般分两步（不包括pipeline和PubSub）

* 客户端（client）向服务端（server）发送一条命令
* 服务端解析并执行命令，返回响应结果给客户端

因此客户端发送命令的格式、服务端响应结果的格式必须有一个规范，这个规范就是通信协议。



在Redis中采用的是**RESP**（Redis Serialization Protocol）协议



* lRedis 1.2版本引入了RESP协议
* lRedis 2.0版本中成为与Redis服务端通信的标准，称为RESP2
* lRedis 6.0版本中，从RESP2升级到了RESP3协议，增加了更多数据类型并且支持6.0的新特性--客户端缓存



lRedis 2.0版本：

在RESP中，通过首字节的字符来区分不同数据类型，常用的数据类型包括5种

* 单行字符串：首字节是 ‘**+**’ ，后面跟上单行字符串，以CRLF（ "**\r\n**" ）结尾。例如返回"OK"： "+OK\r\n"

* 错误（Errors）：首字节是 ‘**-**’ ，与单行字符串格式一样，只是字符串是异常信息，例如："-Error message\r\n"

* 数值：首字节是 ‘**:**’ ，后面跟上数字格式的字符串，以CRLF结尾。例如：":10\r\n"

* 多行字符串：首字节是 ‘**$**’ ，表示二进制安全的字符串，最大支持512MB。例如：$5\r\nhello***\r\n

    * $5的数字5：字符串占用字节大小
    * hello：真正的字符串数据
    * 如果大小为0，则代表空字符串："$0\r\n\r\n"
    * u如果大小为-1，则代表不存在："$-1\r\n"

* 数组：首字节是 ‘*’，后面跟上数组元素个数，再跟上元素，元素数据类型不限

  ```sh
  *3\r\n
  :10\r\n
  $5\r\nhello\r\n
  ```







## 模拟Redis客户端
代码在src目录